<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#06070b; --bg1:#0b0e17;
      --text:#e9ecf7; --muted:#aab2d3;
      --accent:#7c5cff; --accent2:#23d5ab;
      --shadow: 0 24px 70px rgba(0,0,0,.55);
      --radius:18px;
      --stroke: rgba(255,255,255,.10);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Tajawal, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px 14px;
      background:
        radial-gradient(1200px 600px at 75% 20%, rgba(124,92,255,.25), transparent 55%),
        radial-gradient(900px 500px at 15% 80%, rgba(35,213,171,.16), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }
    .wrap{
      width: min(1020px, 100%);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
    }
    @media (max-width: 900px){
      .wrap{grid-template-columns:1fr}
    }
    .card{
      border:1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(14,18,32,.88), rgba(14,18,32,.62));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .left{padding:18px}
    .right{padding:18px}

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
    }
    .logo{
      width:46px;height:46px;
      border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display:grid;place-items:center;
      color:#071018;
      font-weight:900;
      box-shadow: 0 16px 40px rgba(124,92,255,.25);
    }
    h1{margin:0;font-size:22px;font-weight:900;line-height:1.4}
    .subtitle{margin:8px 0 0;color:var(--muted);line-height:1.9;font-size:14px}

    .featureGrid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width: 520px){
      .featureGrid{grid-template-columns:1fr}
    }
    .feature{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.20);
      border-radius: 14px;
      padding:12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .icon{
      min-width:34px;height:34px;
      border-radius:12px;
      background: rgba(124,92,255,.18);
      border:1px solid rgba(124,92,255,.35);
      display:grid;place-items:center;
      font-weight:900;
    }
    .feature b{display:block;margin-bottom:4px}
    .feature span{color:var(--muted);font-size:13px;line-height:1.7}

    .steps{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.20);
      border-radius: 16px;
      padding:14px;
    }
    .steps h3{margin:0 0 10px;font-size:16px;font-weight:900}
    .step{display:flex;gap:10px;align-items:flex-start;margin-top:10px}
    .num{
      min-width:30px;height:30px;
      border-radius:12px;
      background: rgba(35,213,171,.16);
      border:1px solid rgba(35,213,171,.35);
      display:grid;place-items:center;
      font-weight:900;
    }
    .stepText{color:var(--muted);font-size:13.5px;line-height:1.8}

    .formTitle{margin:0 0 10px;font-size:18px;font-weight:900}
    .field{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    label{color:var(--muted);font-size:13px;font-weight:700}
    input{
      width:100%;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.25);
      color:var(--text);
      border-radius:14px;
      padding:14px 12px;
      outline:none;
      font-size:14px;
      letter-spacing:.4px;
    }
    input::placeholder{color: rgba(170,178,211,.7)}

    .row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .btn{
      border:0;
      border-radius:14px;
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      flex:1;
      min-width: 170px;
      text-decoration:none;
    }
    .btnPrimary{
      color:#071018;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
    }
    .btnGhost{
      color:var(--text);
      background: rgba(0,0,0,.25);
      border:1px solid var(--stroke);
      flex:0.9;
    }
    .btnGhost:hover{border-color: rgba(124,92,255,.45)}
    .btnPrimary:disabled{opacity:.7;cursor:not-allowed}

    .msg{margin-top:12px;min-height:22px;color:var(--muted);line-height:1.6;font-size:13px}
    .msg.err{color:#ffb3c0}
    .msg.ok{color:#8ff3dd}

    .small{margin-top:10px;color:var(--muted);font-size:12.5px;line-height:1.8}

    .tgIcon{
      width:18px;height:18px; display:inline-block;
      background: currentColor;
      -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240"><path d="M120 0C53.7 0 0 53.7 0 120s53.7 120 120 120 120-53.7 120-120S186.3 0 120 0zm58.6 82.1-19.7 92.8c-1.5 6.6-5.5 8.2-11.2 5.1l-31-22.8-15 14.4c-1.7 1.7-3.1 3.1-6.4 3.1l2.2-31.6 57.5-51.9c2.5-2.2-.5-3.5-3.9-1.3L79.8 133.9 49.4 124.4c-6.6-2.1-6.7-6.6 1.4-9.8l118.8-45.8c5.5-2 10.3 1.3 8.9 13.3z"/></svg>') center / contain no-repeat;
      mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240"><path d="M120 0C53.7 0 0 53.7 0 120s53.7 120 120 120 120-53.7 120-120S186.3 0 120 0zm58.6 82.1-19.7 92.8c-1.5 6.6-5.5 8.2-11.2 5.1l-31-22.8-15 14.4c-1.7 1.7-3.1 3.1-6.4 3.1l2.2-31.6 57.5-51.9c2.5-2.2-.5-3.5-3.9-1.3L79.8 133.9 49.4 124.4c-6.6-2.1-6.7-6.6 1.4-9.8l118.8-45.8c5.5-2 10.3 1.3 8.9 13.3z"/></svg>') center / contain no-repeat;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Left: about / how it works -->
    <div class="card left">
      <div class="brand">
        <div class="logo">ğŸ¬</div>
        <div>
          <h1>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h1>
          <div class="subtitle">Ø£ÙÙ„Ø§Ù… ÙˆÙ…Ø³Ù„Ø³Ù„Ø§Øª ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ø­Ø¯Ø© â€” Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙŠÙƒÙˆÙ† Ø¹Ø¨Ø± Ø±Ù…Ø² Ø³Ø±ÙŠ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….</div>
        </div>
      </div>

      <div class="featureGrid">
        <div class="feature">
          <div class="icon">â˜¾</div>
          <div><b>ÙˆØ§Ø¬Ù‡Ø© Ø¯Ø§ÙƒÙ†Ø©</b><span>ØªØµÙ…ÙŠÙ… Ù†Ø¸ÙŠÙ ÙˆÙ…Ø±ÙŠØ­ Ù„Ù„Ø¹ÙŠÙ†.</span></div>
        </div>
        <div class="feature">
          <div class="icon">âš¡</div>
          <div><b>ØªØ´ØºÙŠÙ„ Ø³Ø±ÙŠØ¹</b><span>Ù…Ø´ØºÙ‘Ù„ Ø­Ø¯ÙŠØ« ÙˆØªØ¬Ø±Ø¨Ø© Ø³Ù„Ø³Ø©.</span></div>
        </div>
        <div class="feature">
          <div class="icon">ğŸ”</div>
          <div><b>Ø¨Ø­Ø« ÙˆÙÙ„Ø§ØªØ±</b><span>Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£ÙÙ„Ø§Ù… ÙˆØ§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø¨Ø³Ù‡ÙˆÙ„Ø©.</span></div>
        </div>
        <div class="feature">
          <div class="icon">ğŸ”’</div>
          <div><b>Ø¯Ø®ÙˆÙ„ Ù…Ø­Ù…ÙŠ</b><span>Ø±Ù…Ø² Ù…Ø¤Ù‚Øª ÙŠÙØ³ØªØ®Ø¯Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.</span></div>
        </div>
      </div>

      <div class="steps">
        <h3>ÙƒÙŠÙ ØªØ¯Ø®Ù„ØŸ</h3>
        <div class="step">
          <div class="num">1</div>
          <div class="stepText">Ø§ÙØªØ­ Ø§Ù„Ø¨ÙˆØª Ø¹Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ÙˆØ£Ø±Ø³Ù„ Ø§Ù„Ø£Ù…Ø± <b>/code</b>.</div>
        </div>
        <div class="step">
          <div class="num">2</div>
          <div class="stepText">Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø² ÙˆØ§Ù„ØµÙ‚Ù‡ Ù‡Ù†Ø§ Ø«Ù… Ø§Ø¶ØºØ· <b>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</b>.</div>
        </div>
        <div class="step">
          <div class="num">3</div>
          <div class="stepText">Ø³ØªÙ†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± ÙÙŠÙ„Ù… Ø£Ùˆ Ù…Ø³Ù„Ø³Ù„.</div>
        </div>
      </div>

      <div class="small">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø±Ù…Ø² ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© ÙˆÙŠÙØ³ØªØ®Ø¯Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.
      </div>
    </div>

    <!-- Right: login -->
    <div class="card right">
      <h2 class="formTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø±Ù…Ø²</h2>
      <div class="subtitle">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ ÙˆØµÙ„Ùƒ Ù…Ù† Ø§Ù„Ø¨ÙˆØª.</div>

      <div class="field">
        <label for="code">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</label>
        <input id="code" autocomplete="one-time-code" inputmode="latin" placeholder="XXXX-XXXX-XXXX-XXXX" />
      </div>

      <div class="row">
        <button id="loginBtn" class="btn btnPrimary">
          <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
        </button>

        <a id="botBtn" class="btn btnGhost" href="#" target="_blank" rel="noopener">
          <span class="tgIcon" aria-hidden="true"></span>
          <span>ÙØªØ­ Ø§Ù„Ø¨ÙˆØª</span>
        </a>
      </div>

      <div id="msg" class="msg"></div>

      <div class="small">
        Ø¥Ø°Ø§ Ù„Ù… ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø²ØŒ Ø§ÙØªØ­ Ø§Ù„Ø¨ÙˆØª Ø«Ù… Ø£Ø±Ø³Ù„ <b>/code</b>.
      </div>
    </div>
  </div>

  <script>
    // âœ… CHANGE THIS ONCE (without @)
    const BOT_USERNAME = "windsmoviebot";

    const codeEl = document.getElementById("code");
    const msgEl = document.getElementById("msg");
    const loginBtn = document.getElementById("loginBtn");
    const botBtn = document.getElementById("botBtn");

    botBtn.href = "https://t.me/" + BOT_USERNAME;

    function setMsg(text, type){
      msgEl.textContent = text || "";
      msgEl.className = "msg" + (type ? (" " + type) : "");
    }

    function normalizeCode(s){
      return String(s || "")
        .trim()
        .toUpperCase()
        .replace(/\s+/g, "")
        .replace(/â€”/g, "-");
    }

    // Format typing as XXXX-XXXX-XXXX-XXXX
    codeEl.addEventListener("input", () => {
      const raw = normalizeCode(codeEl.value).replace(/[^A-Z0-9]/g, "");
      const chunks = [];
      for (let i = 0; i < raw.length; i += 4) chunks.push(raw.slice(i, i + 4));
      codeEl.value = chunks.join("-").slice(0, 19);
      setMsg("");
    });

    async function login(){
      const code = normalizeCode(codeEl.value);
      if (!code || code.length < 8) {
        setMsg("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² ØµØ­ÙŠØ­.", "err");
        return;
      }

      loginBtn.disabled = true;
      setMsg("Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²...", "");

      try{
        const res = await fetch("/.netlify/functions/redeem", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          setMsg(data.error || "Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ.", "err");
          loginBtn.disabled = false;
          return;
        }

        setMsg("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ… ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ø§Ù„Ø¢Ù†...", "ok");
        setTimeout(() => (window.location.href = "/browse.html"), 500);
      } catch (e) {
        setMsg("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "err");
        loginBtn.disabled = false;
      }
    }

    loginBtn.addEventListener("click", login);
    codeEl.addEventListener("keydown", (e) => { if (e.key === "Enter") login(); });

    // If already logged in, go to library
    (async () => {
      try{
        const me = await fetch("/.netlify/functions/me").then(r => r.json());
        if (me && me.loggedIn) window.location.href = "/browse.html";
      } catch {}
    })();
  </script>
</body>
</html>
