<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f172a;
      --text:#e5e7eb;
      --muted:#a1a1aa;
      --border:rgba(255,255,255,.08);
      --accent:#22c55e;
      --accent2:#38bdf8;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, sans-serif;
      background:
        radial-gradient(900px 500px at 80% -10%, rgba(56,189,248,.14), transparent 60%),
        radial-gradient(900px 500px at 10% 10%, rgba(34,197,94,.14), transparent 55%),
        linear-gradient(180deg, #05070d, var(--bg));
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .container{
      max-width:420px;
      width:100%;
    }
    .card{
      background:linear-gradient(180deg, rgba(15,23,42,.95), rgba(11,18,36,.95));
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:40px 30px;
      box-shadow:var(--shadow);
    }
    .logo{
      width:60px;
      height:60px;
      margin:0 auto 20px;
      border-radius:16px;
      background:linear-gradient(135deg, rgba(34,197,94,.9), rgba(56,189,248,.9));
      box-shadow:0 10px 30px rgba(34,197,94,.15);
    }
    h1{
      margin:0 0 8px;
      font-size:26px;
      text-align:center;
      letter-spacing:.3px;
    }
    .subtitle{
      text-align:center;
      color:var(--muted);
      font-size:14px;
      margin:0 0 30px;
      line-height:1.5;
    }
    .form-group{
      margin-bottom:20px;
    }
    .form-group label{
      display:block;
      margin-bottom:8px;
      font-size:14px;
      color:var(--muted);
      font-weight:500;
    }
    .input-wrapper{
      position:relative;
    }
    .form-group input{
      width:100%;
      padding:14px 16px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--border);
      border-radius:12px;
      color:var(--text);
      font-size:15px;
      transition: border-color .2s;
      font-family: 'Courier New', monospace;
      letter-spacing: 1px;
    }
    .form-group input:focus{
      outline:none;
      border-color:var(--accent);
      background:rgba(255,255,255,.06);
    }
    .form-group input::placeholder{
      color:var(--muted);
      opacity:.5;
    }
    .btn{
      width:100%;
      padding:14px;
      background:var(--accent);
      border:none;
      border-radius:12px;
      color:#000;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s;
      letter-spacing:.3px;
    }
    .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 8px 20px rgba(34,197,94,.3);
    }
    .btn:active{
      transform:translateY(0);
    }
    .btn:disabled{
      opacity:.5;
      cursor:not-allowed;
      transform:none;
    }
    .divider{
      display:flex;
      align-items:center;
      gap:12px;
      margin:24px 0;
      color:var(--muted);
      font-size:13px;
    }
    .divider::before, .divider::after{
      content:'';
      flex:1;
      height:1px;
      background:var(--border);
    }
    .bot-btn{
      width:100%;
      padding:12px;
      background:rgba(56,189,248,.1);
      border:1px solid rgba(56,189,248,.3);
      border-radius:12px;
      color:var(--accent2);
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      transition:all .2s;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      text-decoration:none;
    }
    .bot-btn:hover{
      background:rgba(56,189,248,.15);
      border-color:rgba(56,189,248,.4);
    }
    .error{
      margin-top:12px;
      padding:12px;
      background:rgba(239,68,68,.1);
      border:1px solid rgba(239,68,68,.3);
      border-radius:10px;
      color:#fca5a5;
      font-size:13px;
      text-align:center;
      display:none;
    }
    .error.show{display:block}
    .success{
      margin-top:12px;
      padding:12px;
      background:rgba(34,197,94,.1);
      border:1px solid rgba(34,197,94,.3);
      border-radius:10px;
      color:var(--accent);
      font-size:13px;
      text-align:center;
      display:none;
    }
    .success.show{display:block}
    .info{
      margin-top:20px;
      padding:14px;
      background:rgba(56,189,248,.08);
      border:1px solid rgba(56,189,248,.2);
      border-radius:12px;
      font-size:13px;
      line-height:1.6;
      color:var(--muted);
    }
    .spinner{
      display:inline-block;
      width:16px;
      height:16px;
      border:2px solid rgba(0,0,0,.2);
      border-top-color:#000;
      border-radius:50%;
      animation:spin .6s linear infinite;
    }
    @keyframes spin{
      to{transform:rotate(360deg)}
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="card">
      <div class="logo"></div>
      <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h1>
      <p class="subtitle">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø©</p>

      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="code">Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
          <div class="input-wrapper">
            <input 
              type="text" 
              id="code" 
              name="code"
              placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ù‡Ù†Ø§"
              autocomplete="off"
              autocorrect="off"
              autocapitalize="off"
              spellcheck="false"
              required
            />
          </div>
        </div>

        <button type="submit" class="btn" id="submitBtn">
          <span id="btnText">Ø¯Ø®ÙˆÙ„</span>
        </button>

        <div class="error" id="errorMsg"></div>
        <div class="success" id="successMsg"></div>
      </form>

      <div class="divider">Ø£Ùˆ</div>

      <a href="https://t.me/windsmoviebot" class="bot-btn" target="_blank">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
        </svg>
        Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ù…Ù† Ø§Ù„Ø¨ÙˆØª
      </a>

      <div class="info">
        ðŸ’¡ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø¨ÙˆØª Ø¹Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…ØŒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙ…ØªÙ„ÙƒÙ‡Ø§.
      </div>
    </div>
  </div>

<script>
async function handleLogin(event) {
  event.preventDefault();
  
  const codeInput = document.getElementById('code');
  const submitBtn = document.getElementById('submitBtn');
  const btnText = document.getElementById('btnText');
  const errorMsg = document.getElementById('errorMsg');
  const successMsg = document.getElementById('successMsg');
  
  const code = codeInput.value.trim();
  
  if (!code) {
    showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„');
    return;
  }
  
  // Clear messages
  errorMsg.classList.remove('show');
  successMsg.classList.remove('show');
  
  // Disable button
  submitBtn.disabled = true;
  btnText.innerHTML = '<span class="spinner"></span>';
  
  try {
    const response = await fetch('/.netlify/functions/redeem', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code })
    });
    
    const data = await response.json();
    
    if (data.success) {
      successMsg.textContent = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...';
      successMsg.classList.add('show');
      
      setTimeout(() => {
        window.location.href = 'browse.html';
      }, 1000);
    } else {
      showError(data.error || 'Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©');
      submitBtn.disabled = false;
      btnText.textContent = 'Ø¯Ø®ÙˆÙ„';
    }
  } catch (error) {
    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
    submitBtn.disabled = false;
    btnText.textContent = 'Ø¯Ø®ÙˆÙ„';
  }
}

function showError(message) {
  const errorMsg = document.getElementById('errorMsg');
  errorMsg.textContent = message;
  errorMsg.classList.add('show');
}

// Prevent any auto-formatting on the input
document.getElementById('code').addEventListener('input', function(e) {
  // Remove any auto-added dashes or special characters if needed
  // This ensures only what the user types appears
  const cursorPos = this.selectionStart;
  const oldValue = this.value;
  const newValue = oldValue; // Keep exactly what user typed
  
  if (oldValue !== newValue) {
    this.value = newValue;
    this.setSelectionRange(cursorPos, cursorPos);
  }
});

// Auto-focus on input when page loads
window.addEventListener('load', () => {
  document.getElementById('code').focus();
});
</script>

</body>
</html>
